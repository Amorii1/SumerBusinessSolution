@page
@model SumerBusinessSolution.Pages.Sales.Billings.CreateModel
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@{
    ViewData["Title"] = "Create";
    Layout = "~/Pages/Shared/_Layout.cshtml";
}


<head>

</head>
<body style="margin-left:150px;">


    <style>
        th {
            text-align: left;
        }

        td {
            padding: 5px;
        }
    </style>
    <div style="width:700px; padding:5px; background-color:white;">
        @*@using (Html.BeginForm("BulkData", "Save", FormMethod.Post))
            {*@
        @Html.AntiForgeryToken()
        @Html.ValidationSummary(true)
        <form method="post">

            <table id="dataTable" border="0" cellpadding="0" cellspacing="0">
                <tr>
                    <th>Product Code</th>
                    <th>Qty</th>
                    <th>Unit Price</th>
                    <th>Total Amt</th>
                    <th>Note</th>
                    <th></th>
                </tr>
                @if (Model.Bi != null && Model.Bi.Count > 0)
                {
                    <tr>
                        <td>
                            <select asp-for="a => @Model.BillHeader.CustId"
                                    asp-items="@(new SelectList(Model.Customer, "Id", "CompanyName"))"
                                    class="form-control ">
                            </select>
                        </td>

                    </tr>

                    <tr>
                        <td>Note</td>
                        <td>
                            <input type="text" asp-for="a => @Model.BillHeader.Note" class="form-control text-md-right" />
                        </td>
                    </tr>
                    <tr>
                        <td>Paid Amt</td>
                        <td>
                            <input type="text" asp-for="a => @Model.BillHeader.PaidAmt" class="form-control text-md-right" />
                        </td>
                    </tr>
                    <tr>
                        <td>Discount</td>
                        <td>
                            <input type="text" asp-for="a => @Model.BillHeader.Discount" class="form-control text-md-right" />
                        </td>
                    </tr>
                }
            </table>
            <input type="submit" value="Save" />
        </form>
        @*}*@
        <button onclick="addToTable()"> Add table</button>
    </div>
</body>

@section Scripts {
    @{ await Html.RenderPartialAsync("_ValidationScriptsPartial");}

    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <script>
        $(document).ready(function () {
            addToTable()
        });

        let tableList = 0
        function addToTable() {
            if(tableList >= 15) {
                return
            }
            const tableLineNumber = tableList
            
            const dataTable = $('#dataTable')
        dataTable.append(`
                @*<tr style="border:1px solid black">
                    <td><input type="text" name="Id" id="ProdInfo${tableLineNumber}" asp-for= "a =>  @Model.Bi[${tableLineNumber}].ProdInfo.Id"  class="form-control text-md-right" /></td>
                    <td><input type="text" name="qty" id="qty${tableLineNumber}" asp-for="a => @Model.Bi[0].Qty"  class="form-control text-md-right" /></td>
                    <td><input type="text" name="UnitPrice" id="UnitPrice${tableLineNumber}" asp-for="a => @Model.Bi[0].UnitPrice"  class="form-control text-md-right" /></td>
                    <td><input type="text" name="TotalAmt" id="TotalAmt${tableLineNumber}" asp-for="a => @Model.Bi[0].TotalAmt"  class="form-control text-md-right" /></td>
                    <td><input type="text" name="Note" asp-for="a => @Model.Bi[0].Note"  class="form-control text-md-right" /></td>
                    <td></td>
                </tr>*@
            `)

             $(`#ProdInfo${tableLineNumber}`).autocomplete({
                 source: '@Url.Page("Create", "SearchNow")'

             });

            $(`#ProdInfo${tableLineNumber}`).change(() => {
                fetch(`${window.location.href}?handler=ProdUnitPrice&term=${ $('#ProdInfo' + tableLineNumber).val()}`).then(x => x.json()).then(x => $(`#UnitPrice${tableLineNumber}`).val(x[0]))

            });

            $(`#qty${tableLineNumber}`).change(() => {
                $(`#TotalAmt${tableLineNumber}`).val($(`#qty${tableLineNumber}`).val() * $(`#UnitPrice${tableLineNumber}`).val())
            })

            tableList++

        }





    </script>
}


